---
/* This component is used to display current month tickets */

import Ticket from "./Ticket.astro"
import { getShops, getTickets } from "../utils"
const { token } = Astro.props

const shops = await getShops(token)

const params = {
    year: new Date().getFullYear(),
    month: new Date().getMonth() + 1
}
let tickets = await getTickets(token, params)
tickets = tickets.map((ticket) => {
    return {...ticket, shop: shops.find((shop) => shop.id === ticket.shop) || undefined}
})

---
<div>
    <p><a href="/dashboard/newticket">Nuevo Ticket</a></p>
    <h2>Tickets del mes</h2>
    {tickets && tickets.map((ticket) => <Ticket id={ticket.id} date={ticket.date} amount={ticket.amount} shop={ticket.shop} />)}
</div>